<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Presensi & Nilai Siswa</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 font-weight=%22bold%22 font-family=%22sans-serif%22 fill=%22%230284c7%22>C</text></svg>">
    
    <!-- Memuat Pustaka Eksternal -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Memuat Font dan File CSS Kustom -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tautan ke File CSS Eksternal -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 font-sans">

    <!-- Layar Login -->
    <div id="login-screen" class="fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="text-center bg-white/95 backdrop-blur-sm p-8 sm:p-12 rounded-lg shadow-2xl max-w-md w-full">
            <h1 class="text-4xl font-bold text-sky-600 mb-2">CESANA+</h1>
            <p class="text-gray-600 mb-8">Presensi & Nilai Secepat Klik</p>
            <p class="mb-6">Silakan masuk untuk melanjutkan</p>
            <button id="login-btn" class="bg-white text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-100 shadow-md border border-gray-200 flex items-center gap-3 mx-auto">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.519-3.487-11.187-8.261l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C44.434,36.336,48,30.342,48,24c0-3.374-0.421-6.634-1.198-9.712L43.611,20.083z"></path></svg>
                <span>Masuk dengan Google</span>
            </button>
        </div>
    </div>

    <div id="app-container" class="hidden flex h-screen">
        <!-- Navigasi Samping -->
        <nav id="sidebar" class="w-64 bg-white shadow-md flex-col fixed inset-y-0 left-0 z-50 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out no-print">
              <div>
                  <div class="p-6 hidden md:block">
                      <h1 class="text-2xl font-bold text-sky-600">CESANA+</h1>
                      <p class="text-xs text-gray-500">Presensi & Nilai Secepat Klik</p>
                  </div>
                  <div id="spreadsheet-indicator" class="px-6 py-2 border-t border-b border-gray-200 flex items-center gap-2 text-sm">
                      <!-- Indikator akan diisi oleh JavaScript -->
                  </div>
              </div>
            <!-- Badge PRO -->
            <div class="px-6 py-4">
                <div class="p-3 bg-gradient-to-r from-yellow-400 to-amber-500 rounded-lg text-center shadow-md">
                    <div class="flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <span class="font-bold text-white text-sm">GOLD MEMBER</span>
                    </div>
                </div>
            </div>
            <ul class="flex-grow">
                <li class="nav-item"><a href="#dashboard" class="flex items-center gap-3 p-4 text-gray-700 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg><span>Dasbor</span></a></li>
                <li class="nav-item"><a href="#student-list" class="flex items-center gap-3 p-4 text-gray-700 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" /></svg><span>Daftar Siswa</span></a></li>
                <li class="nav-item"><a href="#grades-dashboard" class="flex items-center gap-3 p-4 text-gray-700 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" /></svg><span>Rekap Nilai</span></a></li>
                <li class="nav-item"><a href="#laporan" class="flex items-center gap-3 p-4 text-gray-700 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a1 1 0 001 1h12a1 1 0 001-1V5a1 1 0 000-2H3zm12 12H5a1 1 0 01-1-1v-1h12v1a1 1 0 01-1 1z" clip-rule="evenodd" /><path d="M11 7a1 1 0 10-2 0v4a1 1 0 102 0V7zM7 9a1 1 0 10-2 0v2a1 1 0 102 0V9zM15 9a1 1 0 10-2 0v2a1 1 0 102 0V9z" /></svg><span>Laporan</span></a></li>
                <li class="nav-item"><a href="#integrasi" class="flex items-center gap-3 p-4 text-gray-700 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" /></svg><span>Integrasi</span></a></li>
                <li class="nav-item"><a href="#pengaturan" class="flex items-center gap-3 p-4 text-gray-700 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.532 1.532 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.532 1.532 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg><span>Pengaturan</span></a></li>
            </ul>
            <div id="user-profile" class="p-4 border-t mt-auto">
                <!-- User info will be injected here -->
            </div>
        </nav>

        <!-- Overlay untuk Mobile -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>
        
        <main class="flex-1 flex flex-col overflow-hidden">
            <div id="global-toast" class="hidden fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-transform duration-300 transform translate-x-full">
                <p id="toast-message">Pesan notifikasi.</p>
            </div>

            <!-- Header untuk Mobile -->
            <header class="md:hidden bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-40 no-print">
                <div class="flex items-center gap-2">
                    <h1 class="text-xl font-bold text-sky-600">CESANA+</h1>
                </div>
                <button id="hamburger-btn" class="text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </header>
            <div class="flex-1 p-4 md:p-8 overflow-y-auto">
                
                <section id="dashboard-page" class="page-section">
                    <!-- Konten Dasbor -->
                    <div id="storage-warning-banner" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-md" role="alert">
                        <p class="font-bold">Peringatan</p>
                        <p>Antrean sinkronisasi Anda menggunakan banyak ruang lokal. Pastikan Anda memiliki koneksi internet untuk mengirim data.</p>
                    </div>
                    <div class="hidden md:flex justify-between items-center mb-6">
                        <div>
                            <h2 id="greeting" class="text-3xl font-bold text-gray-800">Dasbor</h2>
                            <p id="current-date" class="text-gray-600"></p>
                        </div>
                        <div id="current-time" class="text-3xl font-mono font-bold text-gray-800"></div>
                    </div>
                    <div id="summary-section" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-lg flex flex-col items-center justify-center">
                            <div class="relative w-32 h-32">
                                <svg class="w-full h-full" viewBox="0 0 36 36" transform="rotate(-90)">
                                    <path class="text-gray-200" stroke-width="3.5" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                    <path id="progress-ring-circle" stroke-width="3.5" fill="none" stroke-linecap="round" stroke-dasharray="100, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                </svg>
                                <div id="progress-ring-text" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-2xl font-bold text-gray-700">0%</div>
                            </div>
                            <p class="mt-4 font-semibold text-gray-700 text-center">Rekap Harian Selesai</p>
                        </div>
                        <div class="lg:col-span-2 bg-gradient-to-br from-purple-600 to-indigo-900 text-white p-6 rounded-lg shadow-lg flex flex-col justify-center">
                            <h3 class="text-xl font-bold text-center mb-4">Ringkasan Cepat Hari Ini</h3>
                            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                                <div>
                                    <p id="total-present" class="text-4xl font-bold">0</p>
                                    <p class="opacity-80">Total Siswa Hadir</p>
                                </div>
                                <div>
                                    <p id="total-absent" class="text-4xl font-bold">0</p>
                                    <p class="opacity-80">Total Siswa Tidak Hadir</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h3 class="text-2xl font-bold mb-4 text-gray-700">Rekap Per Kelas</h3>
                    <div id="empty-dashboard" class="hidden bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative text-center">
                        <strong class="font-bold">Selamat Datang!</strong>
                        <span class="block sm:inline">Silakan tambahkan kelas terlebih dahulu di menu Pengaturan.</span>
                    </div>
                    <div id="class-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </section>

                <section id="student-list-page" class="page-section">
                    <h2 class="text-3xl font-bold mb-4 text-gray-800">Daftar Siswa</h2>
                     <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                        <label for="student-list-class-filter" class="block mb-1 font-medium">Pilih Kelas</label>
                        <select id="student-list-class-filter" class="w-full md:w-1/3 p-2 border rounded"></select>
                    </div>
                    <div id="student-list-table-container" class="overflow-x-auto bg-white rounded-lg shadow-md p-6">
                        <!-- Daftar siswa akan dirender di sini -->
                    </div>
                </section>

                 <section id="individual-report-page" class="page-section">
                    <div class="flex justify-between items-center mb-6 no-print">
                        <button id="back-to-student-list-btn" class="text-indigo-600 hover:underline font-semibold">&larr; Kembali ke Daftar Siswa</button>
                        <button id="print-report-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">Cetak Rapor</button>
                    </div>
                    <div id="individual-report-content" class="printable-area bg-white p-8 rounded-lg shadow-lg">
                        <!-- Konten Laporan Individu akan dirender di sini -->
                    </div>
                </section>


                <section id="grades-dashboard-page" class="page-section">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">Rekap Nilai Siswa</h2>
                    <p class="text-gray-600 mb-6">Pilih kelas untuk memulai menambahkan atau melihat rekap nilai siswa.</p>
                    <div id="grade-class-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Kartu kelas untuk rekap nilai akan dirender di sini -->
                    </div>
                </section>
                
                <section id="grade-input-page" class="page-section">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4" id="grade-input-class-title">Rekap Nilai Kelas...</h2>
                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end mb-6">
                            <div>
                                <label for="assessment-select" class="block mb-1 font-medium text-gray-700">Pilih Jenis Penilaian</label>
                                <select id="assessment-select" class="w-full p-2 border rounded border-gray-300"></select>
                            </div>
                            <button id="create-assessment-btn" class="bg-indigo-500 text-white px-6 py-2 rounded hover:bg-indigo-600 h-10 w-full md:w-auto">
                                Buat Penilaian Baru
                            </button>
                        </div>
                        <div id="student-grade-list-container" class="overflow-x-auto">
                            <!-- Daftar siswa untuk input nilai akan dirender di sini -->
                             <p class="text-gray-500 p-4 text-center">Pilih atau buat jenis penilaian untuk memulai.</p>
                        </div>
                         <div class="mt-8 text-right">
                            <button id="save-grades-btn" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-bold hidden">Simpan Nilai</button>
                        </div>
                    </div>
                </section>
                
                <section id="laporan-page" class="page-section">
                      <h2 class="text-3xl font-bold mb-4 text-gray-800">Pusat Laporan</h2>
                      
                      <!-- Tombol Tab untuk Pemilihan Jenis Laporan -->
                      <div class="mb-6 border-b border-gray-200">
                          <nav class="flex space-x-4" aria-label="Tabs">
                              <button id="show-attendance-report-btn" class="report-tab-btn active font-semibold px-4 py-2 rounded-t-lg">Laporan Presensi</button>
                              <button id="show-grade-report-btn" class="report-tab-btn font-semibold px-4 py-2 rounded-t-lg text-gray-500 hover:text-indigo-600">Laporan Nilai</button>
                          </nav>
                      </div>

                      <!-- Kontainer untuk Laporan Presensi -->
                      <div id="attendance-report-view">
                          <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                                <div>
                                    <label for="report-class-select" class="block mb-1 font-medium">Pilih Kelas</label>
                                    <select id="report-class-select" class="w-full p-2 border rounded"></select>
                                </div>
                                <div>
                                    <label for="report-period-select" class="block mb-1 font-medium">Periode</label>
                                    <select id="report-period-select" class="w-full p-2 border rounded">
                                        <option value="this_month">Bulan Ini</option>
                                        <option value="today">Hari Ini</option>
                                        <option value="last_7_days">7 Hari Terakhir</option>
                                        <option value="last_14_days">14 Hari Terakhir</option>
                                        <option value="last_month">1 Bulan Lalu</option>
                                        <option value="custom">Rentang Kustom</option>
                                    </select>
                                </div>
                                <button id="generate-report-btn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 h-10 w-full flex items-center justify-center gap-2">
                                    <span id="report-btn-text">Tampilkan Laporan</span>
                                    <div id="report-btn-spinner" class="spinner hidden"></div>
                                </button>
                            </div>
                            <div id="custom-range-container" class="hidden grid-cols-1 md:grid-cols-3 gap-4 items-end mt-4">
                                <div class="md:col-start-2">
                                    <label for="report-start-date" class="block mb-1 font-medium">Tanggal Mulai</label>
                                    <input type="date" id="report-start-date" class="w-full p-2 border rounded">
                                </div>
                                <div>
                                    <label for="report-end-date" class="block mb-1 font-medium">Tanggal Selesai</label>
                                    <input type="date" id="report-end-date" class="w-full p-2 border rounded">
                                </div>
                            </div>
                          </div>
                          <div id="report-output" class="hidden">
                               <div class="flex flex-col md:flex-row justify-end mb-4 space-y-2 md:space-y-0 md:space-x-2">
                                 <button id="export-csv-btn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Ekspor ke CSV</button>
                                 <button id="export-pdf-btn" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">Ekspor ke PDF</button>
                            </div>
                            <div id="report-printable-area" class="space-y-8 bg-white p-4 md:p-8 rounded-lg shadow-lg">
                                <div>
                                    <h3 id="report-header-title" class="text-2xl font-bold text-center">Laporan Kehadiran</h3>
                                    <p id="report-header-subtitle" class="text-center text-gray-600"></p>
                                </div>
                                <div id="report-summary-card" class="bg-gray-50 p-6 rounded-lg border">
                                    <h4 class="text-lg font-semibold mb-4 text-gray-800">Rangkuman Kelas</h4>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                        <div><p id="summary-total-days" class="text-2xl font-bold text-blue-600">0</p><p class="text-sm text-gray-500">Total Hari Efektif</p></div>
                                        <div><p id="summary-avg-presence" class="text-2xl font-bold text-green-600">0%</p><p class="text-sm text-gray-500">Rata-Rata Kehadiran</p></div>
                                        <div><p id="summary-total-students" class="text-2xl font-bold text-gray-700">0</p><p class="text-sm text-gray-500">Jumlah Siswa</p></div>
                                        <div><p id="summary-total-records" class="text-2xl font-bold text-gray-700">0</p><p class="text-sm text-gray-500">Total Data Absensi</p></div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold mb-4 text-gray-800">Detail Kehadiran Siswa</h4>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full bg-white">
                                            <thead class="bg-gray-200">
                                                <tr>
                                                    <th class="py-2 px-4 border-b text-left">Nama Siswa</th>
                                                    <th class="py-2 px-4 border-b">Hadir</th>
                                                    <th class="py-2 px-4 border-b">Sakit</th>
                                                    <th class="py-2 px-4 border-b">Izin</th>
                                                    <th class="py-2 px-4 border-b">Alfa</th>
                                                    <th class="py-2 px-4 border-b">Kehadiran (%)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="report-table-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold mb-4 text-gray-800">Grafik Visual Kehadiran</h4>
                                    <div class="h-96"><canvas id="report-chart"></canvas></div>
                                </div>
                            </div>
                          </div>
                          <div id="report-guide" class="text-center py-16">
                            <p class="text-gray-500">Silakan pilih kelas dan rentang tanggal, lalu klik 'Tampilkan Laporan' untuk melihat hasilnya.</p>
                          </div>
                      </div>

                      <!-- Kontainer untuk Laporan Nilai -->
                      <div id="grade-report-view" class="hidden">
                           <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                                    <div>
                                        <label for="grade-report-class-select" class="block mb-1 font-medium">Pilih Kelas</label>
                                        <select id="grade-report-class-select" class="w-full p-2 border rounded"></select>
                                    </div>
                                    <button id="generate-grade-report-btn" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 h-10 w-full flex items-center justify-center gap-2">
                                        <span id="grade-report-btn-text">Tampilkan Rapor Kelas</span>
                                        <div id="grade-report-btn-spinner" class="spinner hidden"></div>
                                    </button>
                                </div>
                            </div>
                            <div id="grade-report-output" class="hidden">
                                <div class="flex flex-col md:flex-row justify-end mb-4 space-y-2 md:space-y-0 md:space-x-2">
                                     <button id="export-grade-csv-btn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Ekspor ke CSV</button>
                                     <button id="export-grade-pdf-btn" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">Ekspor ke PDF</button>
                                </div>
                                <div id="grade-report-printable-area" class="space-y-8 bg-white p-4 md:p-8 rounded-lg shadow-lg">
                                    <div>
                                        <h3 id="grade-report-header-title" class="text-2xl font-bold text-center">Rapor Nilai Kelas</h3>
                                        <p id="grade-report-header-subtitle" class="text-center text-gray-600"></p>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Tabel Nilai Siswa</h4>
                                        <div id="grade-report-table-container" class="overflow-x-auto">
                                            <!-- Tabel nilai akan dirender di sini oleh JS -->
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Statistik Penilaian</h4>
                                        <div id="grade-report-stats-container" class="overflow-x-auto">
                                            <!-- Tabel statistik akan dirender di sini oleh JS -->
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Grafik Rata-Rata Penilaian</h4>
                                        <div class="h-96"><canvas id="grade-report-chart"></canvas></div>
                                    </div>
                                </div>
                            </div>
                           <div id="grade-report-guide" class="text-center py-16">
                               <p class="text-gray-500">Silakan pilih kelas, lalu klik 'Tampilkan Rapor Kelas' untuk melihat hasilnya.</p>
                           </div>
                      </div>
                </section>
        
                <section id="integrasi-page" class="page-section">
                    <h2 class="text-3xl font-bold mb-6 text-gray-800">Integrasi Google Sheet</h2>
                    <div class="bg-white p-8 rounded-lg shadow-lg max-w-2xl mx-auto">
                        <h3 class="text-xl font-semibold mb-2">Hubungkan Aplikasi dengan Google Sheet</h3>
                        <p class="text-gray-600 mb-6">Ikuti petunjuk penyiapan untuk mendapatkan URL Web App dari Google Apps Script, lalu tempelkan di bawah ini untuk mengaktifkan sinkronisasi data otomatis.</p>
                        
                         <div class="mb-4">
                            <label for="spreadsheet-name" class="block mb-1 font-medium text-gray-700">Nama Tampilan Spreadsheet</label>
                            <input type="text" id="spreadsheet-name" placeholder="Contoh: Absensi Kelas 2024" class="w-full p-2 border rounded border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="mb-4">
                            <label for="gscript-url" class="block mb-1 font-medium text-gray-700">URL Web App Google Apps Script</label>
                            <input type="url" id="gscript-url" placeholder="https://script.google.com/macros/s/..." class="w-full p-2 border rounded border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="flex items-center gap-4">
                            <button id="save-gscript-url-btn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 flex items-center gap-2">
                                <span id="save-btn-text">Simpan & Tes Koneksi</span>
                                <div id="save-btn-spinner" class="spinner hidden"></div>
                            </button>
                            <p id="connection-status" class="text-sm font-medium"></p>
                        </div>
                        
                        <hr class="my-8">

                        <div>
                            <h4 class="text-lg font-semibold mb-2">Status Sinkronisasi</h4>
                            <p class="text-gray-600 mb-4">Aplikasi akan mencoba mengirim data ke Google Sheet setiap kali Anda menyimpan perubahan. Jika gagal (mis. tidak ada internet), data tetap aman tersimpan di perangkat ini.</p>
                            <div id="sync-queue-status" class="bg-gray-100 p-4 rounded-lg">
                                <p class="font-medium">Data Menunggu Sinkronisasi: <span id="sync-queue-count" class="font-bold">0</span> item.</p>
                                <button id="retry-sync-btn" class="hidden mt-2 text-sm text-blue-600 hover:underline">Coba Sinkronkan Sekarang</button>
                            </div>
                        </div>

                    </div>
                </section>
                
                <section id="pengaturan-page" class="page-section">
                      <!-- Konten Pengaturan -->
                      <h2 class="text-3xl font-bold mb-6 text-gray-800">Pengaturan</h2>
                    <div class="bg-white p-8 rounded-lg shadow-lg">
                        <div id="class-student-management">
                            <div class="mb-8">
                                <h3 class="text-xl font-semibold mb-4">Tambah Kelas Baru</h3>
                                <div class="flex gap-4">
                                    <input type="text" id="new-class-name" placeholder="Contoh: Kelas 7A" class="flex-grow p-2 border rounded">
                                    <button id="add-class-btn" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">Tambah</button>
                                </div>
                            </div>
                            <hr class="my-8">
                            <div>
                                <h3 class="text-xl font-semibold mb-4">Tambah Siswa</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block mb-1 font-medium">Pilih Kelas</label>
                                        <select id="class-select" class="w-full p-2 border rounded"></select>
                                    </div>
                                    <div>
                                        <label class="block mb-1 font-medium">NIS</label>
                                        <input type="text" id="student-nis" placeholder="Nomor Induk Siswa" class="w-full p-2 border rounded">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block mb-1 font-medium">Nama Siswa</label>
                                        <input type="text" id="student-name" placeholder="Nama Lengkap Siswa" class="w-full p-2 border rounded">
                                    </div>
                                    <div>
                                        <label class="block mb-1 font-medium">Jenis Kelamin</label>
                                        <select id="student-gender" class="w-full p-2 border rounded">
                                            <option value="Laki-laki">Laki-laki</option>
                                            <option value="Perempuan">Perempuan</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block mb-1 font-medium">Tanggal Lahir</label>
                                        <input type="date" id="student-dob" class="w-full p-2 border rounded">
                                    </div>
                                </div>
                                <button id="add-student-btn" class="mt-6 bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">Simpan Siswa</button>
                            </div>
                            <hr class="my-8">
                            <div>
                                <h3 class="text-xl font-semibold mb-4">Data Siswa</h3>
                                <div id="student-list-container" class="overflow-x-auto"></div>
                            </div>
                        </div>
                        <hr class="my-8">

                        <div id="assessment-type-management">
                             <h3 class="text-xl font-semibold mb-4">Manajemen Jenis Penilaian</h3>
                             <p class="text-gray-600 mb-4">Tambahkan jenis penilaian umum di sini (contoh: Ulangan Harian, Tugas, PTS, PAS). Ini akan digunakan sebagai template saat Anda membuat penilaian baru di menu Rekap Nilai.</p>
                             <div class="bg-gray-50 p-4 rounded-lg border mb-6">
                                 <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                                     <div>
                                         <label for="new-assessment-type-name" class="block mb-1 font-medium text-sm">Nama Jenis Penilaian</label>
                                         <input type="text" id="new-assessment-type-name" placeholder="cth: Ulangan Harian" class="w-full p-2 border rounded">
                                     </div>
                                      <div>
                                         <label for="new-assessment-type-max-score" class="block mb-1 font-medium text-sm">Nilai Maksimal</label>
                                         <input type="number" id="new-assessment-type-max-score" value="100" class="w-full p-2 border rounded">
                                     </div>
                                     <button id="add-assessment-type-btn" class="bg-indigo-500 text-white px-6 py-2 rounded hover:bg-indigo-600 h-10">Tambah Jenis</button>
                                 </div>
                             </div>
                             <div id="assessment-type-list-container">
                                 <!-- Daftar Jenis Penilaian akan dirender di sini -->
                             </div>
                        </div>
                        
                        <hr class="my-8">
                        
                        <div id="data-management-section">
                            <h3 class="text-xl font-semibold mb-4">Manajemen Data & Penyimpanan</h3>
                            <div class="mb-6">
                                <label class="block mb-2 font-medium">Penyimpanan Terpakai (Lokal)</label>
                                <div class="w-full bg-gray-200 rounded-full h-4">
                                    <div id="storage-bar" class="bg-blue-500 h-4 rounded-full" style="width: 0%;"></div>
                                </div>
                                <p id="storage-text" class="text-sm text-gray-600 mt-1 text-right">0 KB / 5 MB</p>
                            </div>
                            <div class="mb-8 p-4 border rounded-lg">
                                <h4 class="font-semibold mb-2">Cadangkan & Pulihkan Data</h4>
                                <p class="text-sm text-gray-600 mb-4">Simpan semua data dari Cloud ke sebuah file, atau pulihkan data dari file cadangan ke Cloud.</p>
                                <div class="flex gap-4">
                                    <button id="backup-data-btn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Cadangkan Semua Data</button>
                                    <button id="restore-data-btn" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">Pulihkan dari Cadangan</button>
                                    <input type="file" id="restore-file-input" class="hidden" accept=".json">
                                </div>
                            </div>
                            <div class="p-4 border rounded-lg">
                                <h4 class="font-semibold mb-2">Arsipkan Data Lama</h4>
                                <p class="text-sm text-gray-600 mb-4">Ekspor data absensi lama ke file arsip, lalu hapus dari aplikasi untuk menghemat ruang.</p>
                                <div class="flex flex-wrap items-end gap-4">
                                    <div class="flex-grow">
                                        <label for="archive-period-select" class="block text-sm font-medium text-gray-700">Arsipkan data sebelum:</label>
                                        <select id="archive-period-select" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                            <option value="6m">6 bulan lalu</option>
                                            <option value="1y">1 tahun lalu</option>
                                            <option value="custom">Tanggal spesifik</option>
                                        </select>
                                    </div>
                                    <div id="archive-date-picker-container" class="hidden flex-grow">
                                         <label for="archive-custom-date" class="block text-sm font-medium text-gray-700">Pilih Tanggal:</label>
                                         <input type="date" id="archive-custom-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    </div>
                                    <button id="archive-data-btn" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Arsipkan</button>
                                </div>
                            </div>
                            <div class="mt-8 p-4 border border-red-300 rounded-lg bg-red-50">
                                <h4 class="font-semibold mb-2 text-red-800">Zona Berbahaya</h4>
                                <p class="text-sm text-red-600 mb-4">Tindakan ini akan menghapus semua data (kelas, siswa, absensi) di akun Anda secara permanen. Tindakan ini tidak dapat dibatalkan.</p>
                                <button id="reset-data-btn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Reset Semua Data Akun</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="absensi-page" class="page-section">
                      <!-- Konten Absensi -->
                      <div>
                        <div class="flex justify-between items-start mb-2">
                            <h2 class="text-3xl font-bold text-gray-800" id="attendance-class-title">Absensi Kelas ...</h2>
                            <input type="date" id="attendance-date" class="p-2 border rounded">
                        </div>
                        <div id="recap-status-container" class="text-sm font-semibold mb-6"></div>
                    </div>
                    <div class="bg-white p-8 rounded-lg shadow-lg">
                        <div id="student-attendance-list" class="space-y-4"></div>
                        <div class="mt-8 text-right">
                            <button id="save-attendance-btn" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-bold">Simpan Absensi</button>
                        </div>
                    </div>
                </section>
            </div>
            <footer class="text-center text-sm text-gray-500 p-4 border-t bg-gray-100 no-print">
                (2025) Crafted with ❤️ by Om Ger | Ai-Labs
            </footer>
        </main>
    </div>

    <!-- MODALS -->
    <div id="create-assessment-modal" class="modal fixed inset-0 bg-black bg-opacity-50">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Buat Penilaian Baru</h3>
            <div class="space-y-4">
                <div>
                    <label for="new-assessment-type-select" class="block mb-1 font-medium">Jenis Penilaian</label>
                    <select id="new-assessment-type-select" class="w-full p-2 border rounded"></select>
                </div>
                <div>
                    <label for="new-assessment-name" class="block mb-1 font-medium">Judul Penilaian</label>
                    <input type="text" id="new-assessment-name" placeholder="Contoh: Bab 1 - Bilangan Bulat" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label for="new-assessment-date" class="block mb-1 font-medium">Tanggal Penilaian</label>
                    <input type="date" id="new-assessment-date" class="w-full p-2 border rounded">
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-4">
                <button type="button" class="cancel-btn bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Batal</button>
                <button id="save-assessment-btn" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">Simpan</button>
            </div>
        </div>
    </div>
    <div id="edit-student-modal" class="modal fixed inset-0 bg-black bg-opacity-50"> <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md"> <h3 class="text-xl font-semibold mb-4">Edit Data Siswa</h3> <form id="edit-student-form"> <input type="hidden" id="edit-student-id"> <div class="grid grid-cols-1 gap-4"> <div><label class="block mb-1 font-medium">NIS</label><input type="text" id="edit-student-nis" class="w-full p-2 border rounded"></div> <div><label class="block mb-1 font-medium">Nama Siswa</label><input type="text" id="edit-student-name" class="w-full p-2 border rounded"></div> <div><label class="block mb-1 font-medium">Jenis Kelamin</label><select id="edit-student-gender" class="w-full p-2 border rounded"><option value="Laki-laki">Laki-laki</option><option value="Perempuan">Perempuan</option></select></div> <div><label class="block mb-1 font-medium">Tanggal Lahir</label><input type="date" id="edit-student-dob" class="w-full p-2 border rounded"></div> </div> <div class="mt-6 flex justify-end gap-4"> <button type="button" class="cancel-btn bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Batal</button> <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">Simpan Perubahan</button> </div> </form> </div> </div>
    <div id="move-student-modal" class="modal fixed inset-0 bg-black bg-opacity-50"> <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md"> <h3 class="text-xl font-semibold mb-4">Pindahkan Siswa</h3> <input type="hidden" id="move-student-id"> <p class="mb-4">Pindahkan siswa <strong id="move-student-name"></strong> ke kelas:</p> <select id="move-class-select" class="w-full p-2 border rounded"></select> <div class="mt-6 flex justify-end gap-4"> <button type="button" class="cancel-btn bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Batal</button> <button id="confirm-move-btn" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">Pindahkan</button> </div> </div> </div>
    <div id="delete-student-modal" class="modal fixed inset-0 bg-black bg-opacity-50"> <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm text-center"> <input type="hidden" id="delete-student-id"> <h3 class="text-xl font-semibold mb-2">Anda Yakin?</h3> <p class="mb-6 text-gray-600">Data siswa ini akan dihapus secara permanen dari database.</p> <div class="flex justify-center gap-4"> <button type="button" class="cancel-btn bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Batal</button> <button id="confirm-delete-btn" class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600">Ya, Hapus</button> </div> </div> </div>
    <div id="unsaved-changes-modal" class="modal fixed inset-0 bg-black bg-opacity-50"> <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm text-center"> <h3 class="text-xl font-semibold mb-2">Perubahan Belum Disimpan</h3> <p class="mb-6 text-gray-600">Anda memiliki perubahan yang belum disimpan. Apakah Anda yakin ingin meninggalkan halaman ini?</p> <div class="flex justify-center gap-4"> <button id="stay-on-page-btn" class="bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Tetap di Halaman</button> <button id="leave-page-btn" class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600">Tinggalkan</button> </div> </div> </div>
    <div id="reset-data-modal" class="modal fixed inset-0 bg-black bg-opacity-50"> <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm text-center"> <h3 class="text-xl font-semibold mb-2">Hapus Semua Data Akun?</h3> <p class="mb-6 text-gray-600">Anda yakin ingin menghapus semua data (kelas, siswa, absensi) di akun Anda secara permanen? Tindakan ini tidak dapat dibatalkan.</p> <div class="flex justify-center gap-4"> <button type="button" class="cancel-btn bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Batal</button> <button id="confirm-reset-btn" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-600">Ya, Hapus Semua</button> </div> </div> </div>
    <div id="restore-data-modal" class="modal fixed inset-0 bg-black bg-opacity-50"> 
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm text-center"> 
            <h3 class="text-xl font-semibold mb-2">Timpa Data Saat Ini?</h3> 
            <p class="mb-6 text-gray-600">Anda yakin ingin menimpa semua data saat ini dengan data dari file cadangan? Tindakan ini tidak dapat dibatalkan.</p> 
            <div class="flex justify-center gap-4"> 
                <button type="button" class="cancel-btn bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Batal</button> 
                <button id="confirm-restore-btn" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">Ya, Pulihkan</button> 
            </div> 
        </div> 
    </div>
    <div id="archive-data-modal" class="modal fixed inset-0 bg-black bg-opacity-50"> 
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm text-center"> 
            <h3 class="text-xl font-semibold mb-2">Arsipkan dan Hapus Data?</h3> 
            <p id="archive-confirm-text" class="mb-6 text-gray-600">Arsip data lama berhasil diunduh. Apakah Anda ingin menghapus data ini dari aplikasi untuk menghemat ruang?</p> 
            <div class="flex justify-center gap-4"> 
                <button type="button" class="cancel-btn bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400">Jangan Hapus</button> 
                <button id="confirm-archive-delete-btn" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-600">Ya, Hapus</button> 
            </div> 
        </div> 
    </div>

    <!-- Tautan ke File JavaScript Eksternal -->
    <script type="module" src="main.js"></script>

</body>
</html>

